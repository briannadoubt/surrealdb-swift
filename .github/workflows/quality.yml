name: Code Quality

on:
  pull_request:
    branches: [ main ]

jobs:
  swiftlint:
    name: SwiftLint
    runs-on: macos-14
    if: false  # Disabled until .swiftlint.yml is configured

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Run SwiftLint
      run: |
        if [ -f .swiftlint.yml ]; then
          swiftlint lint --strict
        else
          echo "SwiftLint configuration not found, skipping..."
        fi

  documentation:
    name: Documentation Check
    runs-on: macos-14

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Select Xcode
      run: sudo xcode-select -s /Applications/Xcode_15.2.app

    - name: Verify DocC builds
      run: |
        swift package plugin generate-documentation --target SurrealDB 2>&1 | tee doc-output.txt
        if grep -q "error:" doc-output.txt; then
          echo "Documentation generation failed"
          exit 1
        fi
        echo "Documentation generated successfully"

  security:
    name: Security Audit
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Check for security issues in dependencies
      run: |
        echo "Checking Package.swift for security issues..."
        # Add dependency security scanning here if needed
        echo "No dependency security scanner configured yet"

    - name: Check for hardcoded secrets
      run: |
        echo "Scanning for potential secrets..."
        if grep -r -i "password.*=.*\".*\"" --include="*.swift" .; then
          echo "Warning: Found potential hardcoded passwords"
        fi
        if grep -r "sk-" --include="*.swift" .; then
          echo "Warning: Found potential API keys"
          exit 1
        fi
        echo "No obvious secrets found"
