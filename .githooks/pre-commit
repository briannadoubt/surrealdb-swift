#!/bin/bash

# SwiftLint pre-commit hook
# Runs SwiftLint on staged Swift files before allowing commit

# Check if swiftlint is installed
if ! command -v swiftlint &> /dev/null; then
    echo "‚ö†Ô∏è  SwiftLint not installed. Install with: brew install swiftlint"
    echo "Skipping SwiftLint check..."
    exit 0
fi

# Check if .swiftlint.yml exists
if [ ! -f .swiftlint.yml ]; then
    echo "‚ö†Ô∏è  .swiftlint.yml not found. Skipping SwiftLint check..."
    exit 0
fi

echo "üîç Running SwiftLint..."

# Get list of staged Swift files
SWIFT_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.swift$')

if [ -z "$SWIFT_FILES" ]; then
    echo "‚úÖ No Swift files to lint"
    exit 0
fi

# Run SwiftLint in strict mode
swiftlint lint --strict --quiet

LINT_EXIT_CODE=$?

if [ $LINT_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "‚ùå SwiftLint failed. Please fix the violations above before committing."
    echo "   Run 'swiftlint lint' to see all violations."
    echo "   Run 'swiftlint lint --fix' to auto-fix some violations."
    exit 1
fi

echo "‚úÖ SwiftLint passed"
exit 0
